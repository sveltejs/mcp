# Packaging Svelte Libraries

Use `@sveltejs/package` to build component libraries. Structure is same as SvelteKit apps, but `src/lib` is public-facing (not `src/routes`).

## svelte-package Command

Generates `dist` directory from `src/lib`:
- Preprocesses Svelte components
- Transpiles TypeScript to JavaScript  
- Generates `.d.ts` type definitions (requires `typescript >= 4.0.0`)

## package.json Configuration

### Key Fields

**name** - Package identifier for npm
```json
{ "name": "your-library" }
```

**license** - Usage terms (e.g., `"MIT"`)

**files** - What gets published (README/LICENSE auto-included)
```json
{ "files": ["dist"] }
```

**exports** - Entry points with conditions
```json
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "svelte": "./dist/index.js"
    }
  }
}
```

Export conditions:
- `types` - TypeScript definitions
- `svelte` - For Svelte-aware tooling (use `default` for non-Svelte libraries)

Multiple entry points:
```json
{
  "exports": {
    "./Foo.svelte": {
      "types": "./dist/Foo.svelte.d.ts",
      "svelte": "./dist/Foo.svelte"
    }
  }
}
```

**svelte** - Legacy field for backwards compatibility
```json
{ "svelte": "./dist/index.js" }
```

**sideEffects** - Enables tree-shaking. Mark CSS files as side effects for webpack compatibility:
```json
{ "sideEffects": ["**/*.css"] }
```

## TypeScript

Type definitions auto-generated by default. For non-root exports (e.g., `your-library/foo`), TypeScript won't resolve `types` condition correctly. Two solutions:

**Option 1:** Users set `"moduleResolution": "bundler"` (TS 5+), `"node16"`, or `"nodenext"` in tsconfig

**Option 2:** Use `typesVersions` in package.json:
```json
{
  "exports": {
    "./foo": {
      "types": "./dist/foo.d.ts",
      "svelte": "./dist/foo.js"
    }
  },
  "typesVersions": {
    ">4.0": {
      "foo": ["./dist/foo.d.ts"]
    }
  }
}
```

## Best Practices

- Avoid SvelteKit-specific modules (`$app/*`) unless targeting only SvelteKit projects. Use `esm-env` instead
- Add aliases via `svelte.config.js` (not `vite.config.js`)
- Removing exports or export conditions is a breaking change
- Adding new exports is non-breaking

## Source Maps

Enable declaration maps for "Go to Definition" support:
1. Set `"declarationMap": true` in tsconfig.json
2. Publish source files alongside dist:
```json
{
  "files": [
    "dist",
    "!dist/**/*.test.*",
    "src/lib",
    "!src/lib/**/*.test.*"
  ]
}
```

## CLI Options

```sh
svelte-package [options]
```

- `-w`/`--watch` - Rebuild on changes
- `-i`/`--input` - Input directory (default: `src/lib`)
- `-o`/`--output` - Output directory (default: `dist`)
- `-p`/`--preserve-output` - Don't empty output first (default: `false`)
- `-t`/`--types` - Generate type definitions (default: `true`)
- `--tsconfig` - Path to tsconfig/jsconfig

## Publishing

```sh
npm publish
```

## Caveats

**Relative imports must be fully specified** with extensions:
```js
import { something } from './something/index.js';
```

For TypeScript, import `.ts` files using `.js` extension. Set `"moduleResolution": "NodeNext"` in tsconfig for help.